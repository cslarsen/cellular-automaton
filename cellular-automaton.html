<!DOCTYPE html>
<html>
  <!--
  Created by Christian Stigen Larsen, 2010
  Put into the public domain by the author.
  -->
  <head>

    <title>Cellular Automaton</title>
    <meta charset="utf-8" />

    <style type="text/css">
    body
    {
      font-family: Verdana, Helvetica, 'Sans-serif';
    }

    h1
    {
      font-family: Garamond;
    }

    #bitmap
    {
      border: #ccc 1px solid;
    }

    h1, table, canvas
    {
      margin-bottom: 1em;
    }

    body
    {
      padding: 2em;
      background-color: #fff;
    }

    td
    {
      text-align: center;
    }

    a
    {
      text-decoration: none;
      color: black;
    }
    </style>
  </head>
<body>

  <h1>Cellular Automaton</h1>

  <form method="post" action="javascript:generate(rule.value);">
    <table>
      <tr>
        <td>Rule</td>
        <td><input type="text" size="3" id="rule" value="110" /></td>
        <td><input type="submit" value="Generate" /></td>
      </tr>
    </table>
  </form>

  <table id="patterns">
    <tr>
      <td>Pattern</td>
      <td>111</td>
      <td>110</td>
      <td>101</td>
      <td>100</td>
      <td>011</td>
      <td>010</td>
      <td>001</td>
      <td>000</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Output</td>
      <td id="p7">&nbsp;</td>
      <td id="p6">&nbsp;</td>
      <td id="p5">&nbsp;</td>
      <td id="p4">&nbsp;</td>
      <td id="p3">&nbsp;</td>
      <td id="p2">&nbsp;</td>
      <td id="p1">&nbsp;</td>
      <td id="p0">&nbsp;</td>
      <td id="num">&nbsp;</td>
    </tr>
  </table>

  <canvas id="bitmap" width="640" height="480">
  You must have an HTML 5 / canvas capable browser to view the output.
  </canvas>

  <p class="footer">
  <small>Made by <a href="http://csl.sublevel3.org">Christian Stigen Larsen</a></small>
  </p>

  <script type="text/javascript"><!--

  function $(elementId)
  {
    return document.getElementById(elementId);
  }

  function genRules(rule)
  {
    var rules = [0,0,0,0,0,0,0,0];

    for ( var i=0; i < 8; ++i ) {

      // save values for use with bitmap
      rules[i] = rule & (0x1<<i) ? 0 : 255;

      // and write the rule in the table
      $('p' + i).innerHTML = rules[i] ? 0 : 1;
    }

    return rules;
  }

  function check(rule)
  {
    if ( isNaN(rule) || rule < 0 ) rule = 0;
    if ( rule > 255 ) rule = 255;

    $('rule').value = rule;
    $('num').innerHTML = '= ' + rule + ' (big-endian)';

    return rule;
  }

  function generate(rule)
  {
    rule = check(rule);
    draw(genRules(rule));
  }

  function clear(image, color)
  {
    for ( var p=0; p < image.data.length; ++p ) {
      image.data[p] = color;
    }
  }

  function draw(rules)
  {
    // set up canvas
    var c = $('bitmap').getContext('2d');
    var i = c.getImageData(0, 0, c.canvas.width, c.canvas.height);

    clear(i, 255);

    var w4   = c.canvas.width<<2;
    var line = 0;

    // set top middle pixel
    i.data[0+w4>>1] =
    i.data[1+w4>>1] =
    i.data[2+w4>>1] = 0;

    for ( var x = 0; x < i.data.length; x += 4, line += 4 ) {
      var left  = !(i.data[x-4] & 0x1);
      var right = !(i.data[x+4] & 0x1);

           // handle line ends
           if ( line == 0  ) { left = 0; }
      else if ( line == w4 ) { right = line = 0; }

      i.data[x+w4+0] =
      i.data[x+w4+1] =
      i.data[x+w4+2] = rules[left<<2 | !(i.data[x] & 0x1)<<1 | right];
    }

    c.putImageData(i, 0, 0);
  }

  //--></script>
  </body>
</html>
