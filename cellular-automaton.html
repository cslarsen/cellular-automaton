<!DOCTYPE html>
<html>
  <!--
  Created by Christian Stigen Larsen, 2010
  Put into the public domain by the author.
  -->
  <head>

    <title>Cellular Automaton</title>
    <meta charset="utf-8" />

    <style type="text/css">
    body
    {
      font-family: Verdana, Helvetica, 'Sans-serif';
    }

    h1
    {
      font-family: Garamond;
    }

    #bitmap
    {
      border: #ccc 1px solid;
    }

    h1, table, canvas
    {
      margin-bottom: 1em;
    }

    body
    {
      padding: 2em;
      background-color: #fff;
    }

    td
    {
      text-align: center;
    }

    a
    {
      text-decoration: none;
      color: black;
    }
    </style>
  </head>
<body>

  <h1>Cellular Automaton</h1>

  <form method="post" action="javascript:generate(rule.value);">
    <table>
      <tr>
        <td>Rule</td>
        <td><input type="text" size="3" id="rule" value="110" /></td>
        <td><input type="submit" value="Generate" /></td>
      </tr>
    </table>
  </form>

  <table id="patterns">
    <tr>
      <td>Pattern</td>
      <td>111</td>
      <td>110</td>
      <td>101</td>
      <td>100</td>
      <td>011</td>
      <td>010</td>
      <td>001</td>
      <td>000</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>Output</td>
      <td id="p7">&nbsp;</td>
      <td id="p6">&nbsp;</td>
      <td id="p5">&nbsp;</td>
      <td id="p4">&nbsp;</td>
      <td id="p3">&nbsp;</td>
      <td id="p2">&nbsp;</td>
      <td id="p1">&nbsp;</td>
      <td id="p0">&nbsp;</td>
      <td id="num">&nbsp;</td>
    </tr>
  </table>

  <canvas id="bitmap" width="640" height="480">
  You must have an HTML 5 / canvas capable browser to view the output.
  </canvas>

  <p class="footer">
  <small>Made by <a href="http://csl.sublevel3.org">Christian Stigen Larsen</a></small>
  </p>

  <script type="text/javascript"><!--

  function $(elementId)
  {
    return document.getElementById(elementId);
  }

  function genRules(rule)
  {
    var rules = [0,0,0,0,0,0,0,0];

    for ( var i=0; i < 8; ++i ) {

      // save values for use with bitmap
      rules[i] = rule & (0x1<<i) ? 0 : 255;

      // and write the rule in the table
      $('p' + i).innerHTML = rules[i] ? 0 : 1;
    }

    return rules;
  }

  function check(rule)
  {
    if ( isNaN(rule) || rule < 0 ) rule = 0;
    if ( rule > 255 ) rule = 255;

    $('rule').value = rule;
    $('num').innerHTML = '= ' + rule + ' (big-endian)';

    return rule;
  }

  function generate(rule)
  {
    rule = check(rule);
    draw(genRules(rule));
  }

  function clear(image, width, height)
  {
    var s = width*height*4;

    for ( var p=0; p < s; ++p ) {
      image.data[p] = 255;
    }
  }

  function draw(rules)
  {
    // set up canvas
    var c = $('bitmap').getContext('2d');
    var width  = c.canvas.width;
    var height = c.canvas.height;

    var i = c.getImageData(0, 0, width, height);

    clear(i, width, height);

		var x = 0;
		var y = 0;

    // set top middle pixel
		i.data[2*width+0] =
		i.data[2*width+1] =
		i.data[2*width+2] = 0;
		i.data[2*width+3] = 255;

    for ( y = 1; y < height; ++y ) {
		for ( x = 0; x < width; ++x ) {
			var left   = i.data[4*((y-1)*width+x-1)]  ? 0 : 1;
			var center = i.data[4*((y-1)*width+x+0)]  ? 0 : 1;
			var right  = i.data[4*((y-1)*width+x+1)]  ? 0 : 1;

			if ( x==0 ) { left = 0; }
			if ( x==(width-1) ) { right = 0; }

			i.data[4*(y*width+x)+0] =
			i.data[4*(y*width+x)+1] =
			i.data[4*(y*width+x)+2] = rules[left<<2 | center<<1 | right];
			i.data[4*(y*width+x)+3] = 255;
		}
		}

    c.putImageData(i, 0, 0);
  }

  //--></script>
  </body>
</html>
